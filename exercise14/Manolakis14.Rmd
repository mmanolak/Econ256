---
title: "Exercise 14: Moving to Canada"
author: "Michael Manolakis"
date: "April 2025"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(knitr)
options(scipen=9999)

if (Sys.info()['sysname'] == "Windows") {
  if (Sys.info()['nodename'] == "DegreeLaptop" || Sys.getenv('USERNAME') == "Degree Laptop") {
    setwd("C:/Users/Degree Laptop/Desktop/Spring 2025/3 - Econ 256 (Data Vis)/exercise14")}
  else if (Sys.info()['nodename'] == "Michael" || Sys.getenv('USERNAME') == "Michael") {
    setwd("C:/Users/Michael/Desktop/Spring 2025/3 - Econ 256/R Studio Files/Econ256/exercise14")}
} else if (Sys.info()['sysname'] == "Linux") {
  setwd("~/Desktop/R Files/Econ256/exercise14")
} else if (Sys.info()['sysname'] == "Darwin") {
  setwd("~/Desktop/Spring 2025/3 - Econ 256")}

vanhousing <- read_csv("vanhousing.csv")
vantracts <- read_sf(dsn="vantracts", layer="vantracts") %>%
  left_join(
    vanhousing %>%
      group_by(tract) %>%
      summarize(medprice = median(price, na.rm = TRUE)), by = "tract")
```

```{r compile-summary-list, echo=FALSE}
model_beds <- lm(price ~ Beds, data = vanhousing)
model_baths <- lm(price ~ FullBath, data = vanhousing)
model_full <- lm(price ~ Beds + FullBath + west, data = vanhousing)

van_summary <- list(
  correlation_matrix = vanhousing %>%
    select(price, Beds, FullBath, `area_sqft`) %>%
    cor(use = "complete.obs") %>%
    round(2),

  median_price_west_east = vanhousing %>%
    group_by(west) %>%
    summarize(medprice = median(price, na.rm = TRUE)),

  median_price_by_beds = vanhousing %>%
    group_by(Beds) %>%
    summarise(median_price = median(price, na.rm = TRUE)) %>%
    arrange(Beds),

  top10_largest_homes = vanhousing %>%
    arrange(desc(`area_sqft`)) %>%
    slice_head(n = 10) %>%
    select(`area_sqft`, addressshort, price, Beds),

  summary_stats = tibble(
    median_price = median(vanhousing$price, na.rm = TRUE),
    mean_price = mean(vanhousing$price, na.rm = TRUE),
    sd_price = sd(vanhousing$price, na.rm = TRUE),
    median_beds = median(vanhousing$Beds, na.rm = TRUE),
    median_baths = median(vanhousing$FullBath, na.rm = TRUE),
    median_sqft = median(vanhousing$`area_sqft`, na.rm = TRUE)
  ),

  regression_beds = summary(model_beds),
  regression_baths = summary(model_baths),
  regression_full = summary(model_full)
)
```

## Summary Statistics

The following summary statistics describe key trends in the Vancouver housing market, including central tendency, variation, and structural characteristics.

```{r summary-stats, echo=FALSE}
kable(van_summary$summary_stats)
```

## Average Price Over Time

```{r mean-over-time, echo=FALSE}
vanhousing %>%
  group_by(year_of_sale) %>%
  summarise(mean_price = mean(price, na.rm = TRUE)) %>%
  ggplot(aes(x = year_of_sale, y = mean_price)) +
  geom_line(color = "darkred", linewidth = 1) +
  scale_x_continuous(breaks = seq(2005, 2015, by = 2)) +
  xlab("Year of Sale") +
  ylab("Mean Price") +
  ggtitle("Change in Mean House Price Over Time")
```

\newpage

## Correlation Matrix

```{r correlation-matrix, echo=FALSE}
kable(van_summary$correlation_matrix)
```

## Median Price by West/East

```{r median-west-east, echo=FALSE}
kable(van_summary$median_price_west_east)
```

## Median Price by Number of Bedrooms

```{r median-by-bedrooms, echo=FALSE}
kable(van_summary$median_price_by_beds)
```

## Top 10 Largest Homes by Square Footage

```{r top-10-homes, echo=FALSE}
kable(van_summary$top10_largest_homes)
```

## Regression Analysis

### Price vs. Number of Bedrooms
```{r regression-beds, echo=FALSE}
kable(as.data.frame(van_summary$regression_beds$coefficients), digits = 3)
```

### Price vs. Number of Bathrooms
```{r regression-baths, echo=FALSE}
kable(as.data.frame(van_summary$regression_baths$coefficients), digits = 3)
```

### Price vs. Bedrooms, Bathrooms, and West/East
```{r regression-full, echo=FALSE}
kable(as.data.frame(van_summary$regression_full$coefficients), digits = 3)
```
