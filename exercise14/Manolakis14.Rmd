---
title: "Exercise 14: Moving to Canada"
author: "Michael Manolakis"
date: "April 2025"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(sf)
library(knitr)
options(scipen=9999)

if (Sys.info()['sysname'] == "Windows") {
  if (Sys.info()['nodename'] == "DegreeLaptop" || Sys.getenv('USERNAME') == "Degree Laptop") {
    setwd("C:/Users/Degree Laptop/Desktop/Spring 2025/3 - Econ 256 (Data Vis)/exercise14")}
  else if (Sys.info()['nodename'] == "Michael" || Sys.getenv('USERNAME') == "Michael") {
    setwd("C:/Users/Michael/Desktop/Spring 2025/3 - Econ 256/R Studio Files/Econ256/exercise14")}
} else if (Sys.info()['sysname'] == "Linux") {
  setwd("~/Desktop/R Files/Econ256/exercise14")
} else if (Sys.info()['sysname'] == "Darwin") {
  setwd("~/Desktop/Spring 2025/3 - Econ 256")}

vanhousing <- read_csv("vanhousing.csv")
vantracts <- read_sf(dsn="vantracts", layer="vantracts") %>%
  left_join(
    vanhousing %>%
      group_by(tract) %>%
      summarize(medprice = median(price, na.rm = TRUE)), by = "tract")
```

```{r compile-summary-list, echo=FALSE}
model_beds <- lm(price ~ Beds, data = vanhousing)
model_baths <- lm(price ~ FullBath, data = vanhousing)
model_full <- lm(price ~ Beds + FullBath + west, data = vanhousing)

van_summary <- list(
  correlation_matrix = vanhousing %>%
    select(price, Beds, FullBath, `area_sqft`) %>%
    cor(use = "complete.obs") %>%
    round(2),

  median_price_west_east = vanhousing %>%
    group_by(west) %>%
    summarize(medprice = median(price, na.rm = TRUE)),

  median_price_by_beds = vanhousing %>%
    group_by(Beds) %>%
    summarise(median_price = median(price, na.rm = TRUE)) %>%
    arrange(Beds),

  top10_largest_homes = vanhousing %>%
    arrange(desc(`area_sqft`)) %>%
    slice_head(n = 10) %>%
    select(`area_sqft`, addressshort, price, Beds),

  summary_stats = tibble(
    median_price = median(vanhousing$price, na.rm = TRUE),
    mean_price = mean(vanhousing$price, na.rm = TRUE),
    sd_price = sd(vanhousing$price, na.rm = TRUE),
    median_beds = median(vanhousing$Beds, na.rm = TRUE),
    median_baths = median(vanhousing$FullBath, na.rm = TRUE),
    median_sqft = median(vanhousing$`area_sqft`, na.rm = TRUE)
  ),

  regression_beds = summary(model_beds),
  regression_baths = summary(model_baths),
  regression_full = summary(model_full)
)
```

## Summary Statistics

The following summary statistics describe key trends in the Vancouver housing market, including central tendency, variation, and structural characteristics.

```{r summary-stats, echo=FALSE}
summary_table <- van_summary$summary_stats
names(summary_table) <- c("Median Price", "Mean Price", "Standard Deviation", "Median Beds", "Median Baths", "Median Sqft")
summary_table <- summary_table %>%
  mutate(across(everything(), ~ format(round(.x, 0), big.mark = ",")))
kable(summary_table)
```

## Regression Analysis

### Price vs. Number of Bedrooms
```{r regression-beds, echo=FALSE}
kable(as.data.frame(van_summary$regression_beds$coefficients), digits = 3)
```

### Price vs. Number of Bathrooms
```{r regression-baths, echo=FALSE}
kable(as.data.frame(van_summary$regression_baths$coefficients), digits = 3)
```

### Price vs. Bedrooms, Bathrooms, and West/East
```{r regression-full, echo=FALSE}
kable(as.data.frame(van_summary$regression_full$coefficients), digits = 3)
```

## Price Distributions

```{r histogram, echo=FALSE, fig.width=7, fig.height=4}
ggplot(data = vanhousing, aes(x = price)) +
  geom_histogram(bins = 50, fill = "steelblue", color = "white") +
  scale_x_continuous(breaks = seq(0, 5000000, by = 1000000),
                     labels = c("0", "$1 Mil", "$2 Mil", "$3 Mil", "$4 Mil", "$5 Mil")) +
  ggtitle("Distribution of House Prices in Vancouver") +
  xlab("Price") +
  ylab("Count")
```

## Average Price Over Time

```{r mean-over-time, echo=FALSE, fig.width=7, fig.height=4}
vanhousing %>%
  group_by(year_of_sale) %>%
  summarise(mean_price = mean(price, na.rm = TRUE)) %>%
  ggplot(aes(x = year_of_sale, y = mean_price)) +
  geom_line(color = "darkred", linewidth = 1) +
  scale_x_continuous(breaks = seq(2005, 2015, by = 2)) +
  scale_y_continuous(breaks = seq(600000, 1200000, by = 200000),
                     labels = c("$600K", "$800K", "$1 Mil", "$1.2 Mil")) +
  xlab("Year of Sale") +
  ylab("Mean Price") +
  ggtitle("Change in Mean House Price Over Time")
```

\newpage

## Correlation Matrix

```{r correlation-matrix, echo=FALSE}
cor_table <- van_summary$correlation_matrix
colnames(cor_table) <- rownames(cor_table) <- c("Price", "Beds", "Full Bath", "Area Sqft")
kable(cor_table)
```

## Median Price by West/East

```{r median-west-east, echo=FALSE}
west_table <- van_summary$median_price_west_east
west_table$west <- c("East", "West")
colnames(west_table) <- c("", "Median Price")
west_table$`Median Price` <- format(round(west_table$`Median Price`, 0), big.mark = ",")
kable(west_table)
```

## Median Price by Number of Bedrooms

```{r median-by-bedrooms, echo=FALSE}
beds_table <- van_summary$median_price_by_beds
colnames(beds_table) <- c("Number of Bedrooms", "Median Price")
beds_table$`Median Price` <- format(round(beds_table$`Median Price`, 0), big.mark = ",")
kable(beds_table)
```

## Top 10 Largest Homes by Square Footage

```{r top-10-homes, echo=FALSE}
homes_table <- van_summary$top10_largest_homes
colnames(homes_table) <- c("Area Sqft", "Address", "Price", "Beds")
homes_table$`Area Sqft` <- format(round(homes_table$`Area Sqft`, 0), big.mark = ",")
homes_table$Price <- format(round(homes_table$Price, 0), big.mark = ",")
kable(homes_table)
```

\newpage

## Summary of Information

```{r filtered-homes, echo=FALSE}
filtered_homes <- vanhousing %>%
  filter(Beds >= 6, FullBath >= 5, west == 1, price < 500000) %>%
  select(addressshort, Beds, FullBath, price) %>%
  mutate(price = format(round(price, 0), big.mark = ","))

colnames(filtered_homes) <- c("Address", "Beds", "Full Baths", "Price")
kable(filtered_homes)
```

The above table shows the homes that meet the criteria of having at least 6 bedrooms, 5 full baths, located in the West side of Vancouver, and priced under $500,000. This is a rare find in Vancouver's housing market, as most homes with such features are typically priced much higher. This is shown fact that there only two homes meet this criteria; 141 41ST Ave, and 163 41ST Ave.


